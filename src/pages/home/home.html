<ion-header>
  <ion-navbar color="gray">
    <ion-title>Happening.</ion-title>
    <ion-buttons end>
      <button ion-button (click)="toggleClick()">
        <ion-toggle
          #autoToggle
          [(ngModel)]="data.toggle"
          (ionChange)="changeStatus($event)"
        ></ion-toggle>
      </button>
    </ion-buttons>
  </ion-navbar>
  <ion-searchbar
    [(ngModel)]="data.search"
    showCancelButton="false"
    placeholder="Search"
    (ionInput)="search()"
    (ionCancel)="onCancel($event)"
  >
  </ion-searchbar>
</ion-header>

<ion-content padding>
  <loading *ngIf="isLoading"></loading>
  <div *ngIf="!isLoading">
    <ion-grid class="card-grid" *ngFor="let event of allEvents">
      <ion-row class="top-row" (click)="eventDetails(event)">
        <ion-col col-6>
          <h4>{{ event.title }}</h4>
          <p style="margin: 0;">{{ event.user.name }} invited you</p>
        </ion-col>
        <ion-col col-6 style="line-height: 0;">
          <h4 ion-text text-end *ngIf="event.time">{{ event.time }}</h4>
          <p ion-text text-end class="happening-date">
            {{ setting.formatNormalDate(date) }}
          </p>
        </ion-col>
      </ion-row>
      <ion-row class="bottom-row">
        <ion-col col-8 (click)="eventDetails(event)">
          <div class="icon-txt-wrapper">
            <img src="assets/imgs/location.svg" class="icon-img" />
            <p class="location-txt">{{ event.location }}</p>
          </div>
          <div>
            <img src="assets/imgs/user.svg" class="icon-img" />
            <p class="location-txt">
              {{ event.goings_count }}/{{ event.max }} people synked
            </p>
          </div>
        </ion-col>
        <ion-col col-4 *ngIf="event.goings_count != event.max">
          <button
            ion-button
            color="secondary"
            class="card-btn"
            round
            *ngIf="!event.isSynked"
            (click)="makeGoing(event)"
          >
            <span *ngIf="!event.isInviteActive">Synk</span>
            <ion-spinner
              name="ios-small"
              *ngIf="event.isInviteActive"
              color="light"
            ></ion-spinner>
          </button>
          <button
            ion-button
            color="primary"
            class="card-btn"
            *ngIf="event.isSynked"
            round
            (click)="inviteFriends(event)"
          >
            <span *ngIf="!event.active">Invite</span>
            <ion-spinner
              name="ios-small"
              *ngIf="event.active"
              color="light"
            ></ion-spinner>
          </button>
        </ion-col>
        <ion-col
          col-4
          align-self-center
          *ngIf="event.goings_count == event.max"
        >
          <div class="completed">Completed</div>
        </ion-col>
      </ion-row>
    </ion-grid>
    <not-found *ngIf="allEvents.length == 0" txt="No events found."></not-found>
    <ion-row *ngIf="allEvents.length == 0">
      <button
        class="add-event-btn"
        (click)="createEvent()"
        ion-button
        color="primary"
        round
      >
        Add event
      </button>
    </ion-row>
  </div>

  <ion-infinite-scroll (ionInfinite)="doInfinite($event)">
    <ion-infinite-scroll-content
      loadingText="Loading..."
    ></ion-infinite-scroll-content>
  </ion-infinite-scroll>
</ion-content>
